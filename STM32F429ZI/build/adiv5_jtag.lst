ARM GAS  /var/folders/0d/93p3r6493yg7p0rvl_4r983m0000gn/T//ccoPaF5Y.s 			page 1


   1              		.cpu cortex-m4
   2              		.eabi_attribute 27, 1
   3              		.eabi_attribute 28, 1
   4              		.eabi_attribute 20, 1
   5              		.eabi_attribute 21, 1
   6              		.eabi_attribute 23, 3
   7              		.eabi_attribute 24, 1
   8              		.eabi_attribute 25, 1
   9              		.eabi_attribute 26, 1
  10              		.eabi_attribute 30, 1
  11              		.eabi_attribute 34, 1
  12              		.eabi_attribute 18, 4
  13              		.file	"adiv5_jtag.c"
  14              		.text
  15              	.Ltext0:
  16              		.cfi_sections	.debug_frame
  17              		.section	.text.adiv5_jtag_low_access,"ax",%progbits
  18              		.align	1
  19              		.syntax unified
  20              		.thumb
  21              		.thumb_func
  22              		.fpu fpv4-sp-d16
  24              	adiv5_jtag_low_access:
  25              	.LFB131:
  26              		.file 1 "Src/adiv5/adiv5_jtag.c"
   1:Src/adiv5/adiv5_jtag.c **** /*
   2:Src/adiv5/adiv5_jtag.c ****  * This file is part of the Black Magic Debug project.
   3:Src/adiv5/adiv5_jtag.c ****  *
   4:Src/adiv5/adiv5_jtag.c ****  * Copyright (C) 2011  Black Sphere Technologies Ltd.
   5:Src/adiv5/adiv5_jtag.c ****  * Written by Gareth McMullin <gareth@blacksphere.co.nz>
   6:Src/adiv5/adiv5_jtag.c ****  *
   7:Src/adiv5/adiv5_jtag.c ****  * Copyright (C) 2018  Tomasz Michalec <tomasz.michalec1996@gmail.com>
   8:Src/adiv5/adiv5_jtag.c ****  *
   9:Src/adiv5/adiv5_jtag.c ****  * This program is free software: you can redistribute it and/or modify
  10:Src/adiv5/adiv5_jtag.c ****  * it under the terms of the GNU General Public License as published by
  11:Src/adiv5/adiv5_jtag.c ****  * the Free Software Foundation, either version 3 of the License, or
  12:Src/adiv5/adiv5_jtag.c ****  * (at your option) any later version.
  13:Src/adiv5/adiv5_jtag.c ****  *
  14:Src/adiv5/adiv5_jtag.c ****  * This program is distributed in the hope that it will be useful,
  15:Src/adiv5/adiv5_jtag.c ****  * but WITHOUT ANY WARRANTY; without even the implied warranty of
  16:Src/adiv5/adiv5_jtag.c ****  * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  17:Src/adiv5/adiv5_jtag.c ****  * GNU General Public License for more details.
  18:Src/adiv5/adiv5_jtag.c ****  *
  19:Src/adiv5/adiv5_jtag.c ****  * You should have received a copy of the GNU General Public License
  20:Src/adiv5/adiv5_jtag.c ****  * along with this program.  If not, see <http://www.gnu.org/licenses/>.
  21:Src/adiv5/adiv5_jtag.c ****  */
  22:Src/adiv5/adiv5_jtag.c **** 
  23:Src/adiv5/adiv5_jtag.c **** /*
  24:Src/adiv5/adiv5_jtag.c ****  * What has been modified by Tomasz Michalec:
  25:Src/adiv5/adiv5_jtag.c ****  *   -- Fucntions use new API defined in this project
  26:Src/adiv5/adiv5_jtag.c ****  *   -- Use FreeRTOS memory management
  27:Src/adiv5/adiv5_jtag.c ****  *   -- Now adiv5_jtag use ADIv5_DP_t structure and expose its functions through
  28:Src/adiv5/adiv5_jtag.c ****  *      ADIv5_DP_OPS_t.
  29:Src/adiv5/adiv5_jtag.c ****  */
  30:Src/adiv5/adiv5_jtag.c **** 
  31:Src/adiv5/adiv5_jtag.c **** #include "stm32f4xx_it.h"
  32:Src/adiv5/adiv5_jtag.c **** #include "cmsis_os.h"
ARM GAS  /var/folders/0d/93p3r6493yg7p0rvl_4r983m0000gn/T//ccoPaF5Y.s 			page 2


  33:Src/adiv5/adiv5_jtag.c **** #include "jtag/jtag_scan.h"
  34:Src/adiv5/adiv5_jtag.c **** #include "jtag/jtag_low_level.h"
  35:Src/adiv5/adiv5_jtag.c **** #include "adiv5/adiv5.h"
  36:Src/adiv5/adiv5_jtag.c **** #include "adiv5/adiv5_jtag.h"
  37:Src/adiv5/adiv5_jtag.c **** 
  38:Src/adiv5/adiv5_jtag.c **** #define JTAGDP_ACK_OK	0x02
  39:Src/adiv5/adiv5_jtag.c **** #define JTAGDP_ACK_WAIT	0x01
  40:Src/adiv5/adiv5_jtag.c **** 
  41:Src/adiv5/adiv5_jtag.c **** /* 35-bit registers that control the ADIv5 DP */
  42:Src/adiv5/adiv5_jtag.c **** #define IR_ABORT	0x8
  43:Src/adiv5/adiv5_jtag.c **** #define IR_DPACC	0xA
  44:Src/adiv5/adiv5_jtag.c **** #define IR_APACC	0xB
  45:Src/adiv5/adiv5_jtag.c **** 
  46:Src/adiv5/adiv5_jtag.c **** static uint32_t adiv5_jtag_low_access(void *priv, uint8_t APnDP, uint8_t RnW,
  47:Src/adiv5/adiv5_jtag.c ****               uint8_t addr, uint32_t value)
  48:Src/adiv5/adiv5_jtag.c **** {
  27              		.loc 1 48 0
  28              		.cfi_startproc
  29              		@ args = 4, pretend = 0, frame = 16
  30              		@ frame_needed = 0, uses_anonymous_args = 0
  31              	.LVL0:
  32 0000 2DE9704B 		push	{r4, r5, r6, r8, r9, fp, lr}
  33              	.LCFI0:
  34              		.cfi_def_cfa_offset 28
  35              		.cfi_offset 4, -28
  36              		.cfi_offset 5, -24
  37              		.cfi_offset 6, -20
  38              		.cfi_offset 8, -16
  39              		.cfi_offset 9, -12
  40              		.cfi_offset 11, -8
  41              		.cfi_offset 14, -4
  42 0004 85B0     		sub	sp, sp, #20
  43              	.LCFI1:
  44              		.cfi_def_cfa_offset 48
  45 0006 0E46     		mov	r6, r1
  46 0008 0C99     		ldr	r1, [sp, #48]
  47              	.LVL1:
  49:Src/adiv5/adiv5_jtag.c ****   uint64_t request, response;
  50:Src/adiv5/adiv5_jtag.c ****   uint8_t ack;
  51:Src/adiv5/adiv5_jtag.c **** 
  52:Src/adiv5/adiv5_jtag.c ****   request = ((uint64_t)value << 3) | ((addr >> 1) & 0x06) | (RnW?1:0);
  48              		.loc 1 52 0
  49 000a 4D0F     		lsrs	r5, r1, #29
  50 000c CC00     		lsls	r4, r1, #3
  51 000e 4FEA5308 		lsr	r8, r3, #1
  52 0012 08F00608 		and	r8, r8, #6
  53 0016 5FFA88F8 		uxtb	r8, r8
  54 001a 4FF00009 		mov	r9, #0
  55 001e 44EA080B 		orr	fp, r4, r8
  56 0022 45EA090C 		orr	ip, r5, r9
  57 0026 52B3     		cbz	r2, .L7
  58 0028 0122     		movs	r2, #1
  59              	.LVL2:
  60 002a 0023     		movs	r3, #0
  61              	.LVL3:
  62              	.L2:
  63              		.loc 1 52 0 is_stmt 0 discriminator 4
ARM GAS  /var/folders/0d/93p3r6493yg7p0rvl_4r983m0000gn/T//ccoPaF5Y.s 			page 3


  64 002c 4BEA0204 		orr	r4, fp, r2
  65 0030 4CEA0305 		orr	r5, ip, r3
  66 0034 CDE90245 		strd	r4, [sp, #8]
  53:Src/adiv5/adiv5_jtag.c **** 
  54:Src/adiv5/adiv5_jtag.c ****   jtag_select_dev(((ADIv5_DP_JTAG_t *)priv)->jtag_dev_num);
  67              		.loc 1 54 0 is_stmt 1 discriminator 4
  68 0038 0068     		ldr	r0, [r0]
  69              	.LVL4:
  70 003a FFF7FEFF 		bl	jtag_select_dev
  71              	.LVL5:
  55:Src/adiv5/adiv5_jtag.c ****   jtag_dev_write_ir(APnDP?IR_APACC:IR_DPACC);
  72              		.loc 1 55 0 discriminator 4
  73 003e 0EB3     		cbz	r6, .L8
  74              		.loc 1 55 0 is_stmt 0
  75 0040 0B20     		movs	r0, #11
  76              	.L3:
  77              		.loc 1 55 0 discriminator 4
  78 0042 FFF7FEFF 		bl	jtag_dev_write_ir
  79              	.LVL6:
  56:Src/adiv5/adiv5_jtag.c **** 
  57:Src/adiv5/adiv5_jtag.c **** 	int tries = 1000;
  80              		.loc 1 57 0 is_stmt 1 discriminator 4
  81 0046 4FF47A74 		mov	r4, #1000
  82              	.LVL7:
  83              	.L5:
  58:Src/adiv5/adiv5_jtag.c **** 	do {
  59:Src/adiv5/adiv5_jtag.c ****     jtag_dev_shift_dr((uint_jtag_transfer_t*)&request, (uint_jtag_transfer_t*)&response, 35);
  84              		.loc 1 59 0 discriminator 2
  85 004a 2322     		movs	r2, #35
  86 004c 6946     		mov	r1, sp
  87 004e 02A8     		add	r0, sp, #8
  88 0050 FFF7FEFF 		bl	jtag_dev_shift_dr
  89              	.LVL8:
  60:Src/adiv5/adiv5_jtag.c ****     ack = response & 0x07;
  90              		.loc 1 60 0 discriminator 2
  91 0054 9DF80030 		ldrb	r3, [sp]	@ zero_extendqisi2
  92 0058 03F00703 		and	r3, r3, #7
  93              	.LVL9:
  61:Src/adiv5/adiv5_jtag.c **** 	} while(--tries && (ack == JTAGDP_ACK_WAIT));
  94              		.loc 1 61 0 discriminator 2
  95 005c 013C     		subs	r4, r4, #1
  96              	.LVL10:
  97 005e 01D0     		beq	.L4
  98              		.loc 1 61 0 is_stmt 0 discriminator 1
  99 0060 012B     		cmp	r3, #1
 100 0062 F2D0     		beq	.L5
 101              	.L4:
  62:Src/adiv5/adiv5_jtag.c **** 
  63:Src/adiv5/adiv5_jtag.c ****   /*if (dp->allow_timeout && (ack == JTAGDP_ACK_WAIT))
  64:Src/adiv5/adiv5_jtag.c ****     return 0;*/
  65:Src/adiv5/adiv5_jtag.c **** 
  66:Src/adiv5/adiv5_jtag.c **** 	if(ack != JTAGDP_ACK_OK) {
 102              		.loc 1 66 0 is_stmt 1
 103 0064 022B     		cmp	r3, #2
 104 0066 02D0     		beq	.L6
  67:Src/adiv5/adiv5_jtag.c ****     /* Fatal error if invalid ACK response */
  68:Src/adiv5/adiv5_jtag.c ****     // TODO: do something useful
ARM GAS  /var/folders/0d/93p3r6493yg7p0rvl_4r983m0000gn/T//ccoPaF5Y.s 			page 4


  69:Src/adiv5/adiv5_jtag.c ****     printf("ERROR: ack != JTAGDP_ACK_OK\n");
 105              		.loc 1 69 0
 106 0068 0748     		ldr	r0, .L10
 107 006a FFF7FEFF 		bl	puts
 108              	.LVL11:
 109              	.L6:
  70:Src/adiv5/adiv5_jtag.c **** 	}
  71:Src/adiv5/adiv5_jtag.c **** 
  72:Src/adiv5/adiv5_jtag.c **** 	return (uint32_t)(response >> 3);
 110              		.loc 1 72 0
 111 006e 0098     		ldr	r0, [sp]
 112 0070 C008     		lsrs	r0, r0, #3
  73:Src/adiv5/adiv5_jtag.c **** }
 113              		.loc 1 73 0
 114 0072 019B     		ldr	r3, [sp, #4]
 115 0074 40EA4370 		orr	r0, r0, r3, lsl #29
 116 0078 05B0     		add	sp, sp, #20
 117              	.LCFI2:
 118              		.cfi_remember_state
 119              		.cfi_def_cfa_offset 28
 120              		@ sp needed
 121 007a BDE8708B 		pop	{r4, r5, r6, r8, r9, fp, pc}
 122              	.LVL12:
 123              	.L7:
 124              	.LCFI3:
 125              		.cfi_restore_state
  52:Src/adiv5/adiv5_jtag.c **** 
 126              		.loc 1 52 0
 127 007e 0022     		movs	r2, #0
 128              	.LVL13:
 129 0080 0023     		movs	r3, #0
 130              	.LVL14:
 131 0082 D3E7     		b	.L2
 132              	.LVL15:
 133              	.L8:
  55:Src/adiv5/adiv5_jtag.c **** 
 134              		.loc 1 55 0
 135 0084 0A20     		movs	r0, #10
 136 0086 DCE7     		b	.L3
 137              	.L11:
 138              		.align	2
 139              	.L10:
 140 0088 00000000 		.word	.LC0
 141              		.cfi_endproc
 142              	.LFE131:
 144              		.section	.text.adiv5_jtag_error,"ax",%progbits
 145              		.align	1
 146              		.syntax unified
 147              		.thumb
 148              		.thumb_func
 149              		.fpu fpv4-sp-d16
 151              	adiv5_jtag_error:
 152              	.LFB134:
  74:Src/adiv5/adiv5_jtag.c **** 
  75:Src/adiv5/adiv5_jtag.c **** static void adiv5_jtag_write(void *priv, uint8_t addr, uint32_t value)
  76:Src/adiv5/adiv5_jtag.c **** {
  77:Src/adiv5/adiv5_jtag.c **** 	adiv5_jtag_low_access(priv, ADIV5_LOW_DP, ADIV5_LOW_WRITE, addr, value);
ARM GAS  /var/folders/0d/93p3r6493yg7p0rvl_4r983m0000gn/T//ccoPaF5Y.s 			page 5


  78:Src/adiv5/adiv5_jtag.c **** }
  79:Src/adiv5/adiv5_jtag.c **** 
  80:Src/adiv5/adiv5_jtag.c **** static uint32_t adiv5_jtag_read(void *priv, uint8_t addr)
  81:Src/adiv5/adiv5_jtag.c **** {
  82:Src/adiv5/adiv5_jtag.c **** 	adiv5_jtag_low_access(priv, ADIV5_LOW_DP, ADIV5_LOW_READ, addr, 0);
  83:Src/adiv5/adiv5_jtag.c **** 	return adiv5_jtag_low_access(priv, ADIV5_LOW_DP, ADIV5_LOW_READ,
  84:Src/adiv5/adiv5_jtag.c **** 					ADIV5_DP_RDBUFF, 0);
  85:Src/adiv5/adiv5_jtag.c **** }
  86:Src/adiv5/adiv5_jtag.c **** 
  87:Src/adiv5/adiv5_jtag.c **** static uint32_t adiv5_jtag_error(void *priv)
  88:Src/adiv5/adiv5_jtag.c **** {
 153              		.loc 1 88 0
 154              		.cfi_startproc
 155              		@ args = 0, pretend = 0, frame = 0
 156              		@ frame_needed = 0, uses_anonymous_args = 0
 157              	.LVL16:
 158 0000 30B5     		push	{r4, r5, lr}
 159              	.LCFI4:
 160              		.cfi_def_cfa_offset 12
 161              		.cfi_offset 4, -12
 162              		.cfi_offset 5, -8
 163              		.cfi_offset 14, -4
 164 0002 83B0     		sub	sp, sp, #12
 165              	.LCFI5:
 166              		.cfi_def_cfa_offset 24
 167 0004 0546     		mov	r5, r0
  89:Src/adiv5/adiv5_jtag.c **** 	adiv5_jtag_low_access(priv, ADIV5_LOW_DP, ADIV5_LOW_READ,
 168              		.loc 1 89 0
 169 0006 0024     		movs	r4, #0
 170 0008 0094     		str	r4, [sp]
 171 000a 0423     		movs	r3, #4
 172 000c 0122     		movs	r2, #1
 173 000e 2146     		mov	r1, r4
 174 0010 FFF7FEFF 		bl	adiv5_jtag_low_access
 175              	.LVL17:
  90:Src/adiv5/adiv5_jtag.c **** 				ADIV5_DP_CTRLSTAT, 0);
  91:Src/adiv5/adiv5_jtag.c **** 	return adiv5_jtag_low_access(priv, ADIV5_LOW_DP, ADIV5_LOW_WRITE,
 176              		.loc 1 91 0
 177 0014 054B     		ldr	r3, .L14
 178 0016 0093     		str	r3, [sp]
 179 0018 0423     		movs	r3, #4
 180 001a 2246     		mov	r2, r4
 181 001c 2146     		mov	r1, r4
 182 001e 2846     		mov	r0, r5
 183 0020 FFF7FEFF 		bl	adiv5_jtag_low_access
 184              	.LVL18:
  92:Src/adiv5/adiv5_jtag.c **** 				ADIV5_DP_CTRLSTAT, 0xF0000032) & 0x32;
  93:Src/adiv5/adiv5_jtag.c **** }
 185              		.loc 1 93 0
 186 0024 00F03200 		and	r0, r0, #50
 187 0028 03B0     		add	sp, sp, #12
 188              	.LCFI6:
 189              		.cfi_def_cfa_offset 12
 190              		@ sp needed
 191 002a 30BD     		pop	{r4, r5, pc}
 192              	.LVL19:
 193              	.L15:
ARM GAS  /var/folders/0d/93p3r6493yg7p0rvl_4r983m0000gn/T//ccoPaF5Y.s 			page 6


 194              		.align	2
 195              	.L14:
 196 002c 320000F0 		.word	-268435406
 197              		.cfi_endproc
 198              	.LFE134:
 200              		.section	.text.adiv5_jtag_read,"ax",%progbits
 201              		.align	1
 202              		.syntax unified
 203              		.thumb
 204              		.thumb_func
 205              		.fpu fpv4-sp-d16
 207              	adiv5_jtag_read:
 208              	.LFB133:
  81:Src/adiv5/adiv5_jtag.c **** 	adiv5_jtag_low_access(priv, ADIV5_LOW_DP, ADIV5_LOW_READ, addr, 0);
 209              		.loc 1 81 0
 210              		.cfi_startproc
 211              		@ args = 0, pretend = 0, frame = 0
 212              		@ frame_needed = 0, uses_anonymous_args = 0
 213              	.LVL20:
 214 0000 30B5     		push	{r4, r5, lr}
 215              	.LCFI7:
 216              		.cfi_def_cfa_offset 12
 217              		.cfi_offset 4, -12
 218              		.cfi_offset 5, -8
 219              		.cfi_offset 14, -4
 220 0002 83B0     		sub	sp, sp, #12
 221              	.LCFI8:
 222              		.cfi_def_cfa_offset 24
 223 0004 0546     		mov	r5, r0
  82:Src/adiv5/adiv5_jtag.c **** 	return adiv5_jtag_low_access(priv, ADIV5_LOW_DP, ADIV5_LOW_READ,
 224              		.loc 1 82 0
 225 0006 0024     		movs	r4, #0
 226 0008 0094     		str	r4, [sp]
 227 000a 0B46     		mov	r3, r1
 228 000c 0122     		movs	r2, #1
 229 000e 2146     		mov	r1, r4
 230              	.LVL21:
 231 0010 FFF7FEFF 		bl	adiv5_jtag_low_access
 232              	.LVL22:
  83:Src/adiv5/adiv5_jtag.c **** 					ADIV5_DP_RDBUFF, 0);
 233              		.loc 1 83 0
 234 0014 0094     		str	r4, [sp]
 235 0016 0C23     		movs	r3, #12
 236 0018 0122     		movs	r2, #1
 237 001a 2146     		mov	r1, r4
 238 001c 2846     		mov	r0, r5
 239 001e FFF7FEFF 		bl	adiv5_jtag_low_access
 240              	.LVL23:
  85:Src/adiv5/adiv5_jtag.c **** 
 241              		.loc 1 85 0
 242 0022 03B0     		add	sp, sp, #12
 243              	.LCFI9:
 244              		.cfi_def_cfa_offset 12
 245              		@ sp needed
 246 0024 30BD     		pop	{r4, r5, pc}
 247              		.cfi_endproc
 248              	.LFE133:
ARM GAS  /var/folders/0d/93p3r6493yg7p0rvl_4r983m0000gn/T//ccoPaF5Y.s 			page 7


 250              		.section	.text.adiv5_jtag_write,"ax",%progbits
 251              		.align	1
 252              		.syntax unified
 253              		.thumb
 254              		.thumb_func
 255              		.fpu fpv4-sp-d16
 257              	adiv5_jtag_write:
 258              	.LFB132:
  76:Src/adiv5/adiv5_jtag.c **** 	adiv5_jtag_low_access(priv, ADIV5_LOW_DP, ADIV5_LOW_WRITE, addr, value);
 259              		.loc 1 76 0
 260              		.cfi_startproc
 261              		@ args = 0, pretend = 0, frame = 0
 262              		@ frame_needed = 0, uses_anonymous_args = 0
 263              	.LVL24:
 264 0000 00B5     		push	{lr}
 265              	.LCFI10:
 266              		.cfi_def_cfa_offset 4
 267              		.cfi_offset 14, -4
 268 0002 83B0     		sub	sp, sp, #12
 269              	.LCFI11:
 270              		.cfi_def_cfa_offset 16
  77:Src/adiv5/adiv5_jtag.c **** }
 271              		.loc 1 77 0
 272 0004 0092     		str	r2, [sp]
 273 0006 0B46     		mov	r3, r1
 274 0008 0022     		movs	r2, #0
 275              	.LVL25:
 276 000a 1146     		mov	r1, r2
 277              	.LVL26:
 278 000c FFF7FEFF 		bl	adiv5_jtag_low_access
 279              	.LVL27:
  78:Src/adiv5/adiv5_jtag.c **** 
 280              		.loc 1 78 0
 281 0010 03B0     		add	sp, sp, #12
 282              	.LCFI12:
 283              		.cfi_def_cfa_offset 4
 284              		@ sp needed
 285 0012 5DF804FB 		ldr	pc, [sp], #4
 286              		.cfi_endproc
 287              	.LFE132:
 289              		.section	.text.adiv5_jtag_priv_free,"ax",%progbits
 290              		.align	1
 291              		.syntax unified
 292              		.thumb
 293              		.thumb_func
 294              		.fpu fpv4-sp-d16
 296              	adiv5_jtag_priv_free:
 297              	.LFB135:
  94:Src/adiv5/adiv5_jtag.c **** 
  95:Src/adiv5/adiv5_jtag.c **** static void adiv5_jtag_priv_free(ADIv5_DP_t *this)
  96:Src/adiv5/adiv5_jtag.c **** {
 298              		.loc 1 96 0
 299              		.cfi_startproc
 300              		@ args = 0, pretend = 0, frame = 0
 301              		@ frame_needed = 0, uses_anonymous_args = 0
 302              	.LVL28:
 303 0000 10B5     		push	{r4, lr}
ARM GAS  /var/folders/0d/93p3r6493yg7p0rvl_4r983m0000gn/T//ccoPaF5Y.s 			page 8


 304              	.LCFI13:
 305              		.cfi_def_cfa_offset 8
 306              		.cfi_offset 4, -8
 307              		.cfi_offset 14, -4
 308 0002 0446     		mov	r4, r0
  97:Src/adiv5/adiv5_jtag.c ****   if(this->ap_count) {
 309              		.loc 1 97 0
 310 0004 0188     		ldrh	r1, [r0]
 311 0006 31B9     		cbnz	r1, .L23
 312              	.LVL29:
 313              	.L21:
  98:Src/adiv5/adiv5_jtag.c ****     printf("ERROR: ap_count = %d while freeing adiv5_jtag!\n", this->ap_count);
  99:Src/adiv5/adiv5_jtag.c ****   }
 100:Src/adiv5/adiv5_jtag.c ****   vPortFree(this->priv);
 314              		.loc 1 100 0
 315 0008 A068     		ldr	r0, [r4, #8]
 316 000a FFF7FEFF 		bl	vPortFree
 317              	.LVL30:
 101:Src/adiv5/adiv5_jtag.c ****   vPortFree(this);
 318              		.loc 1 101 0
 319 000e 2046     		mov	r0, r4
 320 0010 FFF7FEFF 		bl	vPortFree
 321              	.LVL31:
 102:Src/adiv5/adiv5_jtag.c **** }
 322              		.loc 1 102 0
 323 0014 10BD     		pop	{r4, pc}
 324              	.LVL32:
 325              	.L23:
  98:Src/adiv5/adiv5_jtag.c ****     printf("ERROR: ap_count = %d while freeing adiv5_jtag!\n", this->ap_count);
 326              		.loc 1 98 0
 327 0016 0248     		ldr	r0, .L24
 328              	.LVL33:
 329 0018 FFF7FEFF 		bl	printf
 330              	.LVL34:
 331 001c F4E7     		b	.L21
 332              	.L25:
 333 001e 00BF     		.align	2
 334              	.L24:
 335 0020 00000000 		.word	.LC1
 336              		.cfi_endproc
 337              	.LFE135:
 339              		.section	.text.adiv5_jtag_handler,"ax",%progbits
 340              		.align	1
 341              		.global	adiv5_jtag_handler
 342              		.syntax unified
 343              		.thumb
 344              		.thumb_func
 345              		.fpu fpv4-sp-d16
 347              	adiv5_jtag_handler:
 348              	.LFB136:
 103:Src/adiv5/adiv5_jtag.c **** 
 104:Src/adiv5/adiv5_jtag.c **** static ADIv5_DP_OPS_t adiv5_jtag_dp_ops = {
 105:Src/adiv5/adiv5_jtag.c ****   adiv5_jtag_write,
 106:Src/adiv5/adiv5_jtag.c ****   adiv5_jtag_read,
 107:Src/adiv5/adiv5_jtag.c ****   adiv5_jtag_error,
 108:Src/adiv5/adiv5_jtag.c ****   adiv5_jtag_low_access,
 109:Src/adiv5/adiv5_jtag.c ****   adiv5_jtag_priv_free
ARM GAS  /var/folders/0d/93p3r6493yg7p0rvl_4r983m0000gn/T//ccoPaF5Y.s 			page 9


 110:Src/adiv5/adiv5_jtag.c **** };
 111:Src/adiv5/adiv5_jtag.c **** 
 112:Src/adiv5/adiv5_jtag.c **** int adiv5_jtag_handler(int dev_num)
 113:Src/adiv5/adiv5_jtag.c **** {
 349              		.loc 1 113 0
 350              		.cfi_startproc
 351              		@ args = 0, pretend = 0, frame = 0
 352              		@ frame_needed = 0, uses_anonymous_args = 0
 353              	.LVL35:
 354 0000 38B5     		push	{r3, r4, r5, lr}
 355              	.LCFI14:
 356              		.cfi_def_cfa_offset 16
 357              		.cfi_offset 3, -16
 358              		.cfi_offset 4, -12
 359              		.cfi_offset 5, -8
 360              		.cfi_offset 14, -4
 361 0002 0546     		mov	r5, r0
 114:Src/adiv5/adiv5_jtag.c ****   uint16_t dev_count;
 115:Src/adiv5/adiv5_jtag.c ****   ADIv5_DP_t *adiv5_jtag_low_level = pvPortMalloc(sizeof(ADIv5_DP_t));
 362              		.loc 1 115 0
 363 0004 0C20     		movs	r0, #12
 364              	.LVL36:
 365 0006 FFF7FEFF 		bl	pvPortMalloc
 366              	.LVL37:
 367 000a 0446     		mov	r4, r0
 368              	.LVL38:
 116:Src/adiv5/adiv5_jtag.c **** 
 117:Src/adiv5/adiv5_jtag.c ****   adiv5_jtag_low_level->priv = pvPortMalloc(sizeof(ADIv5_DP_JTAG_t));
 369              		.loc 1 117 0
 370 000c 0420     		movs	r0, #4
 371              	.LVL39:
 372 000e FFF7FEFF 		bl	pvPortMalloc
 373              	.LVL40:
 374 0012 A060     		str	r0, [r4, #8]
 118:Src/adiv5/adiv5_jtag.c ****   ((ADIv5_DP_JTAG_t*) adiv5_jtag_low_level->priv)->jtag_dev_num = dev_num;
 375              		.loc 1 118 0
 376 0014 0560     		str	r5, [r0]
 119:Src/adiv5/adiv5_jtag.c ****   adiv5_jtag_low_level->ops = &adiv5_jtag_dp_ops;
 377              		.loc 1 119 0
 378 0016 094B     		ldr	r3, .L30
 379 0018 6360     		str	r3, [r4, #4]
 120:Src/adiv5/adiv5_jtag.c ****   adiv5_jtag_low_level->ap_count = 0;
 380              		.loc 1 120 0
 381 001a 0023     		movs	r3, #0
 382 001c 2380     		strh	r3, [r4]	@ movhi
 121:Src/adiv5/adiv5_jtag.c **** 
 122:Src/adiv5/adiv5_jtag.c ****   printf("ADIv5 init start\n");
 383              		.loc 1 122 0
 384 001e 0848     		ldr	r0, .L30+4
 385 0020 FFF7FEFF 		bl	puts
 386              	.LVL41:
 123:Src/adiv5/adiv5_jtag.c ****   dev_count = adiv5_init(adiv5_jtag_low_level);
 387              		.loc 1 123 0
 388 0024 2046     		mov	r0, r4
 389 0026 FFF7FEFF 		bl	adiv5_init
 390              	.LVL42:
 124:Src/adiv5/adiv5_jtag.c **** 
ARM GAS  /var/folders/0d/93p3r6493yg7p0rvl_4r983m0000gn/T//ccoPaF5Y.s 			page 10


 125:Src/adiv5/adiv5_jtag.c ****   if(!dev_count) {
 391              		.loc 1 125 0
 392 002a 0546     		mov	r5, r0
 393              	.LVL43:
 394 002c 08B1     		cbz	r0, .L29
 395              	.LVL44:
 396              	.L27:
 126:Src/adiv5/adiv5_jtag.c ****     // non of AP has been probed successful, free low level adiv5
 127:Src/adiv5/adiv5_jtag.c ****     adiv5_jtag_priv_free(adiv5_jtag_low_level);
 128:Src/adiv5/adiv5_jtag.c ****   }
 129:Src/adiv5/adiv5_jtag.c **** 
 130:Src/adiv5/adiv5_jtag.c ****   return dev_count;
 131:Src/adiv5/adiv5_jtag.c **** }
 397              		.loc 1 131 0
 398 002e 2846     		mov	r0, r5
 399 0030 38BD     		pop	{r3, r4, r5, pc}
 400              	.LVL45:
 401              	.L29:
 127:Src/adiv5/adiv5_jtag.c ****   }
 402              		.loc 1 127 0
 403 0032 2046     		mov	r0, r4
 404              	.LVL46:
 405 0034 FFF7FEFF 		bl	adiv5_jtag_priv_free
 406              	.LVL47:
 407 0038 F9E7     		b	.L27
 408              	.L31:
 409 003a 00BF     		.align	2
 410              	.L30:
 411 003c 00000000 		.word	.LANCHOR0
 412 0040 00000000 		.word	.LC2
 413              		.cfi_endproc
 414              	.LFE136:
 416              		.section	.data.adiv5_jtag_dp_ops,"aw",%progbits
 417              		.align	2
 418              		.set	.LANCHOR0,. + 0
 421              	adiv5_jtag_dp_ops:
 422 0000 00000000 		.word	adiv5_jtag_write
 423 0004 00000000 		.word	adiv5_jtag_read
 424 0008 00000000 		.word	adiv5_jtag_error
 425 000c 00000000 		.word	adiv5_jtag_low_access
 426 0010 00000000 		.word	adiv5_jtag_priv_free
 427              		.section	.rodata.adiv5_jtag_handler.str1.4,"aMS",%progbits,1
 428              		.align	2
 429              	.LC2:
 430 0000 41444976 		.ascii	"ADIv5 init start\000"
 430      3520696E 
 430      69742073 
 430      74617274 
 430      00
 431              		.section	.rodata.adiv5_jtag_low_access.str1.4,"aMS",%progbits,1
 432              		.align	2
 433              	.LC0:
 434 0000 4552524F 		.ascii	"ERROR: ack != JTAGDP_ACK_OK\000"
 434      523A2061 
 434      636B2021 
 434      3D204A54 
 434      41474450 
ARM GAS  /var/folders/0d/93p3r6493yg7p0rvl_4r983m0000gn/T//ccoPaF5Y.s 			page 11


 435              		.section	.rodata.adiv5_jtag_priv_free.str1.4,"aMS",%progbits,1
 436              		.align	2
 437              	.LC1:
 438 0000 4552524F 		.ascii	"ERROR: ap_count = %d while freeing adiv5_jtag!\012\000"
 438      523A2061 
 438      705F636F 
 438      756E7420 
 438      3D202564 
 439              		.text
 440              	.Letext0:
 441              		.file 2 "/usr/local/gcc_arm/gcc-arm-none-eabi-7-2017-q4-major/arm-none-eabi/include/machine/_defau
 442              		.file 3 "/usr/local/gcc_arm/gcc-arm-none-eabi-7-2017-q4-major/arm-none-eabi/include/sys/_stdint.h"
 443              		.file 4 "Drivers/CMSIS/Include/core_cm4.h"
 444              		.file 5 "Drivers/CMSIS/Device/ST/STM32F4xx/Include/system_stm32f4xx.h"
 445              		.file 6 "/usr/local/gcc_arm/gcc-arm-none-eabi-7-2017-q4-major/arm-none-eabi/include/sys/lock.h"
 446              		.file 7 "/usr/local/gcc_arm/gcc-arm-none-eabi-7-2017-q4-major/arm-none-eabi/include/sys/_types.h"
 447              		.file 8 "/usr/local/gcc_arm/gcc-arm-none-eabi-7-2017-q4-major/lib/gcc/arm-none-eabi/7.2.1/include/
 448              		.file 9 "/usr/local/gcc_arm/gcc-arm-none-eabi-7-2017-q4-major/arm-none-eabi/include/sys/reent.h"
 449              		.file 10 "Inc/jtag/jtag_low_level.h"
 450              		.file 11 "Inc/adiv5/adiv5.h"
 451              		.file 12 "Inc/adiv5/adiv5_jtag.h"
 452              		.file 13 "Middlewares/Third_Party/FreeRTOS/Source/include/portable.h"
 453              		.file 14 "/usr/local/gcc_arm/gcc-arm-none-eabi-7-2017-q4-major/arm-none-eabi/include/stdio.h"
 454              		.file 15 "Inc/jtag/jtag_scan.h"
 455              		.file 16 "<built-in>"
ARM GAS  /var/folders/0d/93p3r6493yg7p0rvl_4r983m0000gn/T//ccoPaF5Y.s 			page 12


DEFINED SYMBOLS
                            *ABS*:0000000000000000 adiv5_jtag.c
/var/folders/0d/93p3r6493yg7p0rvl_4r983m0000gn/T//ccoPaF5Y.s:18     .text.adiv5_jtag_low_access:0000000000000000 $t
/var/folders/0d/93p3r6493yg7p0rvl_4r983m0000gn/T//ccoPaF5Y.s:24     .text.adiv5_jtag_low_access:0000000000000000 adiv5_jtag_low_access
/var/folders/0d/93p3r6493yg7p0rvl_4r983m0000gn/T//ccoPaF5Y.s:140    .text.adiv5_jtag_low_access:0000000000000088 $d
/var/folders/0d/93p3r6493yg7p0rvl_4r983m0000gn/T//ccoPaF5Y.s:145    .text.adiv5_jtag_error:0000000000000000 $t
/var/folders/0d/93p3r6493yg7p0rvl_4r983m0000gn/T//ccoPaF5Y.s:151    .text.adiv5_jtag_error:0000000000000000 adiv5_jtag_error
/var/folders/0d/93p3r6493yg7p0rvl_4r983m0000gn/T//ccoPaF5Y.s:196    .text.adiv5_jtag_error:000000000000002c $d
/var/folders/0d/93p3r6493yg7p0rvl_4r983m0000gn/T//ccoPaF5Y.s:201    .text.adiv5_jtag_read:0000000000000000 $t
/var/folders/0d/93p3r6493yg7p0rvl_4r983m0000gn/T//ccoPaF5Y.s:207    .text.adiv5_jtag_read:0000000000000000 adiv5_jtag_read
/var/folders/0d/93p3r6493yg7p0rvl_4r983m0000gn/T//ccoPaF5Y.s:251    .text.adiv5_jtag_write:0000000000000000 $t
/var/folders/0d/93p3r6493yg7p0rvl_4r983m0000gn/T//ccoPaF5Y.s:257    .text.adiv5_jtag_write:0000000000000000 adiv5_jtag_write
/var/folders/0d/93p3r6493yg7p0rvl_4r983m0000gn/T//ccoPaF5Y.s:290    .text.adiv5_jtag_priv_free:0000000000000000 $t
/var/folders/0d/93p3r6493yg7p0rvl_4r983m0000gn/T//ccoPaF5Y.s:296    .text.adiv5_jtag_priv_free:0000000000000000 adiv5_jtag_priv_free
/var/folders/0d/93p3r6493yg7p0rvl_4r983m0000gn/T//ccoPaF5Y.s:335    .text.adiv5_jtag_priv_free:0000000000000020 $d
/var/folders/0d/93p3r6493yg7p0rvl_4r983m0000gn/T//ccoPaF5Y.s:340    .text.adiv5_jtag_handler:0000000000000000 $t
/var/folders/0d/93p3r6493yg7p0rvl_4r983m0000gn/T//ccoPaF5Y.s:347    .text.adiv5_jtag_handler:0000000000000000 adiv5_jtag_handler
/var/folders/0d/93p3r6493yg7p0rvl_4r983m0000gn/T//ccoPaF5Y.s:411    .text.adiv5_jtag_handler:000000000000003c $d
/var/folders/0d/93p3r6493yg7p0rvl_4r983m0000gn/T//ccoPaF5Y.s:417    .data.adiv5_jtag_dp_ops:0000000000000000 $d
/var/folders/0d/93p3r6493yg7p0rvl_4r983m0000gn/T//ccoPaF5Y.s:421    .data.adiv5_jtag_dp_ops:0000000000000000 adiv5_jtag_dp_ops
/var/folders/0d/93p3r6493yg7p0rvl_4r983m0000gn/T//ccoPaF5Y.s:428    .rodata.adiv5_jtag_handler.str1.4:0000000000000000 $d
/var/folders/0d/93p3r6493yg7p0rvl_4r983m0000gn/T//ccoPaF5Y.s:432    .rodata.adiv5_jtag_low_access.str1.4:0000000000000000 $d
/var/folders/0d/93p3r6493yg7p0rvl_4r983m0000gn/T//ccoPaF5Y.s:436    .rodata.adiv5_jtag_priv_free.str1.4:0000000000000000 $d

UNDEFINED SYMBOLS
jtag_select_dev
jtag_dev_write_ir
jtag_dev_shift_dr
puts
vPortFree
printf
pvPortMalloc
adiv5_init
